<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>第八节：初始化单元测试 -- controller -- get</title>
    <meta name="description" content="本节中，我们使用了`mockMvc`模拟进行`http`请求，并使用`print()`方法，将请求结果打印到了控制台中。最后，使用`jsonPath()`对响应结果进行了`json`转换，转换后，使用`is()`成功的进行了断言。"/>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#157878">
    <link rel="stylesheet" href="/SpringMVC/assets/css/style.css?v=">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">SpringMVC API入门教程</h1>
      <h2 class="project-tagline">技术支持：河北工业大学梦云智软件开发团队
</h2>
      
        <a href="https://github.com/mengyunzhi/SpringMVC" class="btn">View on GitHub</a>
      
      
        <a href="https://github.com/mengyunzhi/SpringMVC/archive/master.zip" class="btn">Download .zip</a>
      
    </section>

    <section class="main-content">
      <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">第八节：初始化单元测试 -- controller -- get</h1>
    <p class="post-meta"><time datetime="2017-04-14T13:49:00+08:00" itemprop="datePublished">Apr 14, 2017</time> • <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">潘杰</span></span></p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <p>前面我们在开发<code class="highlighter-rouge">service</code>及<code class="highlighter-rouge">respository</code>时，都引用了单元测试。在开发<code class="highlighter-rouge">controller</code>时，采用的是<code class="highlighter-rouge">postMan</code>的方式。
使用<code class="highlighter-rouge">postMan</code>的优点的操作简单，数据返回直观。缺点当然也是有的，比如上节中，我们遇到的问题。那么，我们在开发<code class="highlighter-rouge">controler</code>时，是否也可以引用单元测试呢？</p>

<p>答案是肯定的。<code class="highlighter-rouge">Spring</code>的官方入门教程，对这个问题进行了讲解:
<a href="https://spring.io/guides/gs/testing-web/">https://spring.io/guides/gs/testing-web/</a></p>

<p>在官方教程的<code class="highlighter-rouge">Building REST services with Spring</code>中，也专门对控制器测试进行了讲解：<a href="https://spring.io/guides/tutorials/bookmarks/">https://spring.io/guides/tutorials/bookmarks/</a></p>

<p>此外，官方文档中，测试又单独的做为一个章节来呈现给我们：
<a href="https://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-testing.html">https://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-testing.html</a></p>

<h1 id="基本代码">基本代码</h1>
<p>我们结合<code class="highlighter-rouge">idea</code>生成基本的测试代码如下：</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">mengyunzhi</span><span class="o">.</span><span class="na">controller</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.boot.test.autoconfigure.web.servlet.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.boot.test.context.SpringBootTest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.test.context.junit4.SpringRunner</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.test.web.servlet.MockMvc</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.junit.Test</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.junit.runner.RunWith</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>

<span class="cm">/**
 * Created by panjie on 17/4/14.
 */</span>
<span class="nd">@RunWith</span><span class="o">(</span><span class="n">SpringRunner</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="nd">@SpringBootTest</span>
<span class="nd">@AutoConfigureMockMvc</span>       <span class="c1">// 自动配置 模块MVC</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">KlassControllerTest</span> <span class="o">{</span>

    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">MockMvc</span> <span class="n">mockMvc</span><span class="o">;</span>


    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">save</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
      
    <span class="o">}</span>

    <span class="nd">@Test</span>
    <span class="c1">// 由于get()与http请求的get命名相同，在这里重新命名以防止冲突。</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">getTest</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>

    <span class="o">}</span>

    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">update</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>

    <span class="o">}</span>

    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">delete</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>

    <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<h2 id="gettest">getTest</h2>
<p>添加注释:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java">    <span class="nd">@Test</span>
    <span class="c1">// 由于get()与http请求的get命名相同，在这里重新命名以防止冲突。</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">getTest</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="c1">// 直接添加一个实体</span>
        
        <span class="c1">// 发起http请求来查询这个实体</span>

        <span class="c1">// 断言这个实体查询成功</span>
    <span class="o">}</span></code></pre></figure>

<p>添加实体：</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java">    <span class="c1">// 由于get()与http请求的get命名相同，在这里重新命名以防止冲突。</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">getTest</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="c1">// 直接添加一个实体</span>
        <span class="n">Klass</span> <span class="n">klass</span> <span class="o">=</span> <span class="n">klassService</span><span class="o">.</span><span class="na">getNewKlass</span><span class="o">();</span>
        <span class="n">String</span> <span class="n">klassId</span> <span class="o">=</span> <span class="n">klass</span><span class="o">.</span><span class="na">getId</span><span class="o">().</span><span class="na">toString</span><span class="o">();</span>

        <span class="c1">// 发起http请求来查询这个实体</span>

        <span class="c1">// 断言这个实体查询成功</span>
    <span class="o">}</span></code></pre></figure>

<p>测试：</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">Hibernate: insert into teacher (address, email, name, sex) values (?, ?, ?, ?)
Hibernate: insert into klass (name, teacher_id) values (?, ?)</code></pre></figure>

<hr />

<p>查询实体：</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">getTest</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="c1">// 直接添加一个实体</span>
        <span class="n">Klass</span> <span class="n">klass</span> <span class="o">=</span> <span class="n">klassService</span><span class="o">.</span><span class="na">getNewKlass</span><span class="o">();</span>
        <span class="n">String</span> <span class="n">klassId</span> <span class="o">=</span> <span class="n">klass</span><span class="o">.</span><span class="na">getId</span><span class="o">().</span><span class="na">toString</span><span class="o">();</span>

        <span class="c1">// 发起http请求来查询这个实体</span>
        <span class="c1">// 1.发请请求</span>
        <span class="c1">// 2. 打印请求结果</span>

        <span class="c1">// 断言这个实体查询成功</span>
    <span class="o">}</span></code></pre></figure>

<p>发起请求：</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">test</span><span class="o">.</span><span class="na">web</span><span class="o">.</span><span class="na">servlet</span><span class="o">.</span><span class="na">request</span><span class="o">.</span><span class="na">MockMvcRequestBuilders</span><span class="o">.</span><span class="na">get</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.test.web.servlet.ResultActions</span><span class="o">;</span>
        <span class="c1">// 1.发请请求</span>
        <span class="n">ResultActions</span> <span class="n">resultActions</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">mockMvc</span><span class="o">.</span><span class="na">perform</span><span class="o">(</span><span class="n">get</span><span class="o">(</span><span class="s">"/klass/"</span> <span class="o">+</span> <span class="n">klassId</span><span class="o">));</span></code></pre></figure>

<p>解读：<code class="highlighter-rouge">ResultActions</code>返回类型，<code class="highlighter-rouge">perform</code>是<code class="highlighter-rouge">this.mockMvc</code>中的一个方法，接收的参数是<code class="highlighter-rouge">get()</code>方法的返回值，<code class="highlighter-rouge">get</code>方法的接收参数是绝对路径的字符串。</p>

<p>打印请求结果：</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">test</span><span class="o">.</span><span class="na">web</span><span class="o">.</span><span class="na">servlet</span><span class="o">.</span><span class="na">result</span><span class="o">.</span><span class="na">MockMvcResultHandlers</span><span class="o">.</span><span class="na">print</span><span class="o">;</span>
        <span class="c1">// 2. 打印请求结果</span>
        <span class="n">resultActions</span><span class="o">.</span><span class="na">andDo</span><span class="o">(</span><span class="n">print</span><span class="o">());</span></code></pre></figure>

<p>代码解读：<code class="highlighter-rouge">andDo</code>是<code class="highlighter-rouge">resultActions</code>对象中的方法，这个方法接收的类型是<code class="highlighter-rouge">print()</code>函数的返回值。这两项共同起到了讲请求结果打印至控制台的作用。</p>

<p>测试：</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="nl">MockHttpServletRequest:</span>         <span class="c1">// 模拟HTTP请求信息</span>
      <span class="n">HTTP</span> <span class="n">Method</span> <span class="o">=</span> <span class="n">GET</span>         <span class="c1">// 请求方法</span>
      <span class="n">Request</span> <span class="n">URI</span> <span class="o">=</span> <span class="o">/</span><span class="n">klass</span><span class="o">/</span><span class="mi">1</span>    <span class="c1">// 请求地址</span>
       <span class="n">Parameters</span> <span class="o">=</span> <span class="o">{}</span>          <span class="c1">// 请求参数</span>
          <span class="n">Headers</span> <span class="o">=</span> <span class="o">{}</span>          <span class="c1">// 请求头信息</span>
<span class="c1">// 处理信息</span>
<span class="nl">Handler:</span>    
            <span class="c1">// 请求类型（对应的类名） 请求方法（对应的方法名） 请求方法中的参数类型</span>
             <span class="n">Type</span> <span class="o">=</span> <span class="n">com</span><span class="o">.</span><span class="na">mengyunzhi</span><span class="o">.</span><span class="na">controller</span><span class="o">.</span><span class="na">KlassController</span>
           <span class="n">Method</span> <span class="o">=</span> <span class="kd">public</span> <span class="n">com</span><span class="o">.</span><span class="na">mengyunzhi</span><span class="o">.</span><span class="na">repository</span><span class="o">.</span><span class="na">Klass</span>  <span class="n">com</span><span class="o">.</span><span class="na">mengyunzhi</span><span class="o">.</span><span class="na">controller</span><span class="o">.</span><span class="na">KlassController</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Long</span><span class="o">)</span>

<span class="nl">Async:</span>      <span class="c1">// 异步信息</span>
    <span class="n">Async</span> <span class="n">started</span> <span class="o">=</span> <span class="kc">false</span>       <span class="c1">// 是否异步请求</span>
     <span class="n">Async</span> <span class="n">result</span> <span class="o">=</span> <span class="kc">null</span>        <span class="c1">// 异步结果 </span>

<span class="n">Resolved</span> <span class="nl">Exception:</span>             <span class="c1">// 异常信息</span>
             <span class="n">Type</span> <span class="o">=</span> <span class="kc">null</span>

<span class="nl">ModelAndView:</span>                   <span class="c1">// ModelAndView 在我们前台后分离中，这个暂时用不到。</span>
        <span class="n">View</span> <span class="n">name</span> <span class="o">=</span> <span class="kc">null</span>
             <span class="n">View</span> <span class="o">=</span> <span class="kc">null</span>
            <span class="n">Model</span> <span class="o">=</span> <span class="kc">null</span>

<span class="nl">FlashMap:</span>
       <span class="n">Attributes</span> <span class="o">=</span> <span class="kc">null</span>

<span class="nl">MockHttpServletResponse:</span>        <span class="c1">// 模拟请求响应</span>
           <span class="n">Status</span> <span class="o">=</span> <span class="mi">200</span>         <span class="c1">// 状态码 200 </span>
    <span class="n">Error</span> <span class="n">message</span> <span class="o">=</span> <span class="kc">null</span>        <span class="c1">// 错误信息</span>
          <span class="n">Headers</span> <span class="o">=</span> <span class="o">{</span><span class="n">Content</span><span class="o">-</span><span class="n">Type</span><span class="o">=[</span><span class="n">application</span><span class="o">/</span><span class="n">json</span><span class="o">;</span><span class="n">charset</span><span class="o">=</span><span class="n">UTF</span><span class="o">-</span><span class="mi">8</span><span class="o">]}</span>    <span class="c1">// Header信息 </span>
     <span class="n">Content</span> <span class="n">type</span> <span class="o">=</span> <span class="n">application</span><span class="o">/</span><span class="n">json</span><span class="o">;</span><span class="n">charset</span><span class="o">=</span><span class="n">UTF</span><span class="o">-</span><span class="mi">8</span>                      <span class="c1">// Content type</span>
             <span class="n">Body</span> <span class="o">=</span> <span class="o">{</span><span class="s">"id"</span><span class="o">:</span><span class="mi">2</span><span class="o">,</span><span class="s">"teacher"</span><span class="o">:{</span><span class="s">"id"</span><span class="o">:</span><span class="mi">2</span><span class="o">,</span><span class="s">"name"</span><span class="o">:</span><span class="s">"示例教师"</span><span class="o">,</span><span class="s">"email"</span><span class="o">:</span><span class="s">"zhangsan@yunzhiclub.com"</span><span class="o">,</span><span class="s">"address"</span><span class="o">:</span><span class="s">"scse of hebut"</span><span class="o">,</span><span class="s">"sex"</span><span class="o">:</span><span class="kc">true</span><span class="o">},</span><span class="s">"name"</span><span class="o">:</span><span class="s">"示例班级"</span><span class="o">}</span> <span class="c1">// Body，返回的主要内容</span>
    <span class="n">Forwarded</span> <span class="n">URL</span> <span class="o">=</span> <span class="kc">null</span>
   <span class="n">Redirected</span> <span class="n">URL</span> <span class="o">=</span> <span class="kc">null</span>
          <span class="n">Cookies</span> <span class="o">=</span> <span class="o">[]</span></code></pre></figure>

<p>在控制台中，详细的打印请求及该请求对应的响应信息。是的，这部分内容我们再熟悉不过了。有了伟大<code class="highlighter-rouge">MockMVC</code>，我们再也不必为交流测试而发愁了。离优秀的团队开发，我们又近了一步。</p>

<p>打印请求结果</p>

<hr />

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">test</span><span class="o">.</span><span class="na">web</span><span class="o">.</span><span class="na">servlet</span><span class="o">.</span><span class="na">result</span><span class="o">.</span><span class="na">MockMvcResultMatchers</span><span class="o">.</span><span class="na">jsonPath</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">hamcrest</span><span class="o">.</span><span class="na">Matchers</span><span class="o">.</span><span class="na">is</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">getTest</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="c1">// 直接添加一个实体</span>
        <span class="n">Klass</span> <span class="n">klass</span> <span class="o">=</span> <span class="n">klassService</span><span class="o">.</span><span class="na">getNewKlass</span><span class="o">();</span>
        <span class="n">String</span> <span class="n">klassId</span> <span class="o">=</span> <span class="n">klass</span><span class="o">.</span><span class="na">getId</span><span class="o">().</span><span class="na">toString</span><span class="o">();</span>

        <span class="c1">// 发起http请求来查询这个实体</span>
        <span class="c1">// 1.发请请求</span>
        <span class="n">ResultActions</span> <span class="n">resultActions</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">mockMvc</span><span class="o">.</span><span class="na">perform</span><span class="o">(</span><span class="n">get</span><span class="o">(</span><span class="s">"/klass/"</span> <span class="o">+</span> <span class="n">klassId</span><span class="o">));</span>
        <span class="c1">// 2. 打印请求结果</span>
        <span class="n">resultActions</span><span class="o">.</span><span class="na">andDo</span><span class="o">(</span><span class="n">print</span><span class="o">());</span>

        <span class="c1">// 断言这个实体查询成功</span>
        <span class="n">resultActions</span><span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">jsonPath</span><span class="o">(</span><span class="s">"$.id"</span><span class="o">,</span> <span class="n">is</span><span class="o">(</span><span class="n">klass</span><span class="o">.</span><span class="na">getId</span><span class="o">().</span><span class="na">intValue</span><span class="o">())));</span>
    <span class="o">}</span></code></pre></figure>

<p>解读：<code class="highlighter-rouge">andExpect</code> – 建立一个断言， <code class="highlighter-rouge">jsonPath()</code> – 将返回的<code class="highlighter-rouge">body</code>数据转化为<code class="highlighter-rouge">json</code>并进行断言判断, <code class="highlighter-rouge">$.id</code> – <code class="highlighter-rouge">$</code>代表返回的<code class="highlighter-rouge">json</code>对象，<code class="highlighter-rouge">is()</code> – 断言值。
上述代码整体表示：建立一个断言：期待返回的结果成功转化为<code class="highlighter-rouge">json</code>格式的数据，转化为<code class="highlighter-rouge">json</code>格式数据后，其中的<code class="highlighter-rouge">id</code>属性的值为<code class="highlighter-rouge">klass</code>的<code class="highlighter-rouge">id</code>值。</p>

<p>测试：</p>

<p><img src="/SpringMVC/assets/image/chapter3/34.png" alt="/SpringMVC/assets/image/chapter3/34.png" /></p>

<h2 id="代码重构">代码重构</h2>
<p>上述代码采用链式调用后，如下：</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java">    <span class="nd">@Test</span>
    <span class="c1">// 由于get()与http请求的get命名相同，在这里重新命名以防止冲突。</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">getTest</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="c1">// 直接添加一个实体</span>
        <span class="n">Klass</span> <span class="n">klass</span> <span class="o">=</span> <span class="n">klassService</span><span class="o">.</span><span class="na">getNewKlass</span><span class="o">();</span>

        <span class="c1">// 发起http请求来查询这个实体</span>
        <span class="k">this</span><span class="o">.</span><span class="na">mockMvc</span><span class="o">.</span><span class="na">perform</span><span class="o">(</span><span class="n">get</span><span class="o">(</span><span class="s">"/klass/"</span> <span class="o">+</span> <span class="n">klass</span><span class="o">.</span><span class="na">getId</span><span class="o">().</span><span class="na">toString</span><span class="o">()))</span>
            <span class="o">.</span><span class="na">andDo</span><span class="o">(</span><span class="n">print</span><span class="o">())</span>
            <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">jsonPath</span><span class="o">(</span><span class="s">"$.id"</span><span class="o">,</span> <span class="n">is</span><span class="o">(</span><span class="n">klass</span><span class="o">.</span><span class="na">getId</span><span class="o">().</span><span class="na">intValue</span><span class="o">())));</span>
    <span class="o">}</span></code></pre></figure>

<p>在教程的编写过程中，<code class="highlighter-rouge">IDEA</code>并没能自动为我们添加好所有的依赖包。故在此给出完事的代码供参考:</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">mengyunzhi</span><span class="o">.</span><span class="na">controller</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.mengyunzhi.repository.Klass</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.mengyunzhi.service.KlassService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.boot.test.context.SpringBootTest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.test.context.junit4.SpringRunner</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.test.web.servlet.MockMvc</span><span class="o">;</span>


<span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">test</span><span class="o">.</span><span class="na">web</span><span class="o">.</span><span class="na">servlet</span><span class="o">.</span><span class="na">request</span><span class="o">.</span><span class="na">MockMvcRequestBuilders</span><span class="o">.</span><span class="na">get</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">test</span><span class="o">.</span><span class="na">web</span><span class="o">.</span><span class="na">servlet</span><span class="o">.</span><span class="na">result</span><span class="o">.</span><span class="na">MockMvcResultHandlers</span><span class="o">.</span><span class="na">print</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">test</span><span class="o">.</span><span class="na">web</span><span class="o">.</span><span class="na">servlet</span><span class="o">.</span><span class="na">result</span><span class="o">.</span><span class="na">MockMvcResultMatchers</span><span class="o">.</span><span class="na">jsonPath</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">static</span> <span class="n">org</span><span class="o">.</span><span class="na">hamcrest</span><span class="o">.</span><span class="na">Matchers</span><span class="o">.</span><span class="na">is</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.junit.Test</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.junit.runner.RunWith</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.test.web.servlet.ResultActions</span><span class="o">;</span>


<span class="cm">/**
 * Created by panjie on 17/4/14.
 */</span>
<span class="nd">@RunWith</span><span class="o">(</span><span class="n">SpringRunner</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="nd">@SpringBootTest</span>
<span class="nd">@AutoConfigureMockMvc</span>       <span class="c1">// 自动配置 模似MVC</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">KlassControllerTest</span> <span class="o">{</span>

    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">MockMvc</span> <span class="n">mockMvc</span><span class="o">;</span>

    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">KlassService</span> <span class="n">klassService</span><span class="o">;</span>

    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">save</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>

    <span class="o">}</span>

    <span class="nd">@Test</span>
    <span class="c1">// 由于get()与http请求的get命名相同，在这里重新命名以防止冲突。</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">getTest</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="c1">// 直接添加一个实体</span>
        <span class="n">Klass</span> <span class="n">klass</span> <span class="o">=</span> <span class="n">klassService</span><span class="o">.</span><span class="na">getNewKlass</span><span class="o">();</span>

        <span class="c1">// 发起http请求来查询这个实体</span>
        <span class="k">this</span><span class="o">.</span><span class="na">mockMvc</span><span class="o">.</span><span class="na">perform</span><span class="o">(</span><span class="n">get</span><span class="o">(</span><span class="s">"/klass/"</span> <span class="o">+</span> <span class="n">klass</span><span class="o">.</span><span class="na">getId</span><span class="o">().</span><span class="na">toString</span><span class="o">()))</span>
                <span class="o">.</span><span class="na">andDo</span><span class="o">(</span><span class="n">print</span><span class="o">())</span>
                <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">jsonPath</span><span class="o">(</span><span class="s">"$.id"</span><span class="o">,</span> <span class="n">is</span><span class="o">(</span><span class="n">klass</span><span class="o">.</span><span class="na">getId</span><span class="o">().</span><span class="na">intValue</span><span class="o">())));</span>
    <span class="o">}</span>

    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">update</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>

    <span class="o">}</span>

    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">delete</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>

    <span class="o">}</span>
<span class="o">}</span></code></pre></figure>

<h1 id="总结">总结：</h1>
<p>本节中，我们使用了<code class="highlighter-rouge">mockMvc</code>模拟进行<code class="highlighter-rouge">http</code>请求，并使用<code class="highlighter-rouge">print()</code>方法，将请求结果打印到了控制台中。最后，使用<code class="highlighter-rouge">jsonPath()</code>对响应结果进行了<code class="highlighter-rouge">json</code>转换，转换后，使用<code class="highlighter-rouge">is()</code>成功的进行了断言。</p>

<h2 id="参考">参考</h2>

<table>
  <tbody>
    <tr>
      <td><a href="https://spring.io/guides/gs/testing-web/">https://spring.io/guides/gs/testing-web/</a></td>
      <td><a href="https://spring.io/guides/tutorials/bookmarks/">https://spring.io/guides/tutorials/bookmarks/</a></td>
      <td><a href="https://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-testing.html">https://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-testing.html</a></td>
      <td><a href="https://docs.spring.io/spring-boot/docs/current/reference/html/test-auto-configuration.html">https://docs.spring.io/spring-boot/docs/current/reference/html/test-auto-configuration.html</a></td>
    </tr>
  </tbody>
</table>

  </div>

  
</article>


      <footer class="site-footer">
        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages </a> and <a href="http://jekyllrb.com/">Jekyll</a>. Powered By: <a href="http://www.mengyunzhi.com">梦云智</a>. </span>
      </footer>
    </section>

  </body>
</html>
